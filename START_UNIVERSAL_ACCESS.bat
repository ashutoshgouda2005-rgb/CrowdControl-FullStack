@echo off
title CrowdControl - Universal Device Access
color 0A

echo.
echo  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó     
echo ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     
echo ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     
echo ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     
echo ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo                           üåê UNIVERSAL ACCESS - Works on ANY Device! üåê
echo                              Phone ‚Ä¢ iPad ‚Ä¢ Laptop ‚Ä¢ Desktop ‚Ä¢ Tablet
echo.
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

echo üîç AUTO-DETECTING ALL NETWORK INTERFACES...

REM Get all possible IP addresses
set "IP_LIST="
for /f "tokens=2 delims=:" %%i in ('ipconfig ^| findstr /i "IPv4"') do (
    for /f "tokens=1" %%j in ("%%i") do (
        set "CURRENT_IP=%%j"
        call :trim_ip
        if not "!TRIMMED_IP!"=="127.0.0.1" (
            if defined IP_LIST (
                set "IP_LIST=!IP_LIST!, !TRIMMED_IP!"
            ) else (
                set "IP_LIST=!TRIMMED_IP!"
            )
            if not defined MAIN_IP set "MAIN_IP=!TRIMMED_IP!"
        )
    )
)

echo ‚úÖ Detected Network Interfaces: %IP_LIST%
echo üéØ Primary Access IP: %MAIN_IP%

echo.
echo üî• CONFIGURING UNIVERSAL ACCESS...
echo    ‚Ä¢ Opening firewall for all network interfaces
echo    ‚Ä¢ Enabling cross-device communication
echo    ‚Ä¢ Setting up automatic discovery

REM Configure firewall for all common ports
netsh advfirewall firewall add rule name="CrowdControl Universal Frontend" dir=in action=allow protocol=TCP localport=5174 >nul 2>&1
netsh advfirewall firewall add rule name="CrowdControl Universal Backend" dir=in action=allow protocol=TCP localport=8000 >nul 2>&1
netsh advfirewall firewall add rule name="CrowdControl Universal Alt" dir=in action=allow protocol=TCP localport=3000 >nul 2>&1
netsh advfirewall firewall add rule name="CrowdControl Universal Dev" dir=in action=allow protocol=TCP localport=8080 >nul 2>&1

echo    ‚úÖ Universal firewall rules configured

echo.
echo üöÄ STARTING UNIVERSAL SERVERS...
echo    ‚Ä¢ Backend: Accessible from ANY device on network
echo    ‚Ä¢ Frontend: Auto-detects and works everywhere
echo    ‚Ä¢ No IP configuration needed!

REM Start backend with universal access
start "CrowdControl Backend (Universal)" cmd /k "call venv\Scripts\activate.bat && cd backend && python manage.py runserver 0.0.0.0:8000"

REM Wait for backend
timeout /t 3 /nobreak >nul

REM Start frontend with universal access and auto-discovery
start "CrowdControl Frontend (Universal)" cmd /k "cd frontend && powershell -ExecutionPolicy Bypass -Command npm run dev -- --host 0.0.0.0 --port 5174"

REM Wait for services
timeout /t 5 /nobreak >nul

echo ‚úÖ UNIVERSAL ACCESS ENABLED!
echo.
echo üåê ACCESS FROM ANY DEVICE:
echo.
echo    üì± PHONE/TABLET:
echo       ‚Ä¢ Connect to same Wi-Fi network
echo       ‚Ä¢ Open browser and go to: http://%MAIN_IP%:5174
echo       ‚Ä¢ Or scan QR code (if available)
echo.
echo    üíª LAPTOP/DESKTOP:
echo       ‚Ä¢ Same network: http://%MAIN_IP%:5174
echo       ‚Ä¢ Local access: http://localhost:5174
echo.
echo    üåç ALL NETWORK IPS:
for %%i in (%IP_LIST%) do (
    echo       ‚Ä¢ http://%%i:5174
)
echo.
echo üéØ UNIVERSAL FEATURES:
echo    ‚ú® Works on ANY device with a browser
echo    ‚ú® Automatic responsive design adaptation
echo    ‚ú® No manual IP configuration needed
echo    ‚ú® Cross-platform compatibility
echo    ‚ú® PWA support for app-like experience
echo.
echo üì± MOBILE OPTIMIZATION:
echo    ‚ú® Touch-friendly interface
echo    ‚ú® Camera access for live streaming
echo    ‚ú® Offline capability (PWA)
echo    ‚ú® Add to home screen support
echo.
echo üîß TROUBLESHOOTING:
echo    ‚Ä¢ All devices must be on the same Wi-Fi network
echo    ‚Ä¢ If connection fails, try different IP from the list above
echo    ‚Ä¢ Restart router if devices can't communicate
echo    ‚Ä¢ Check device firewall settings if needed
echo.

REM Create a simple HTML file for easy access
echo ^<!DOCTYPE html^> > universal_access.html
echo ^<html^>^<head^>^<title^>CrowdControl Universal Access^</title^>^</head^> >> universal_access.html
echo ^<body style="font-family: Arial; text-align: center; padding: 50px;"^> >> universal_access.html
echo ^<h1^>üö® CrowdControl Universal Access^</h1^> >> universal_access.html
echo ^<h2^>Access from ANY Device^</h2^> >> universal_access.html
echo ^<div style="margin: 30px;"^> >> universal_access.html
for %%i in (%IP_LIST%) do (
    echo ^<p^>^<a href="http://%%i:5174" style="font-size: 20px; color: blue;"^>http://%%i:5174^</a^>^</p^> >> universal_access.html
)
echo ^</div^> >> universal_access.html
echo ^<p^>Choose any link above that works for your device^</p^> >> universal_access.html
echo ^</body^>^</html^> >> universal_access.html

echo üìÑ Created universal_access.html for easy device access
echo.
echo üéâ YOUR CROWDCONTROL IS NOW UNIVERSALLY ACCESSIBLE!
echo    Open universal_access.html on any device to get direct links
echo    Or use the IP addresses shown above
echo.
echo    Press Ctrl+C in server windows to stop
echo.
pause

goto :eof

:trim_ip
setlocal enabledelayedexpansion
set "TRIMMED_IP=%CURRENT_IP%"
set "TRIMMED_IP=!TRIMMED_IP: =!"
endlocal & set "TRIMMED_IP=%TRIMMED_IP%"
goto :eof
